name: Upload to MinIO
description: Upload to MinIO with unique URI suffix
inputs:
- {name: Data}  # Input file path         
- {name: MinIO path prefix, type: String}  # MinIO bucket path prefix
outputs:
- {name: MinIO path, type: String}  # Output MinIO path
metadata:
  annotations:
    author: Nikhil <nikhil.v@mobiusdtaas.ai>
implementation:
    container:
        image: ubuntu:20.04  # Using Ubuntu base image to install mc
        command:
        - sh
        - -ex
        - -c
        - |
            # Download the MinIO client (mc)
            wget https://dl.min.io/client/mc/release/linux-amd64/mc

            # Make mc executable
            chmod +x mc

            # Move mc to /usr/local/bin so it's available in the PATH
            mv mc /usr/local/bin/

            # Set up MinIO alias with your local MinIO instance
            mc alias set myminio http://192.168.28.15:9000 minio minio123

            # Copy the data from the input path to MinIO with a unique suffix
            mc cp "$0" "myminio/$1"

            # Create the output directory locally if needed
            mkdir -p "$(dirname "$2")"

            # Save the MinIO path to the output
            echo "myminio/$1" > "$2"
        - inputPath: Data
        - concat: [{inputValue: MinIO path prefix}]
        - outputPath: MinIO path
