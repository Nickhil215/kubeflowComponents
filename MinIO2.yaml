name: Upload to MinIO
description: Upload to a fixed MinIO bucket with application name and directory
inputs:
- {name: Data}  # Input file path or directory
- {name: MinIO bucket name, type: String}  # MinIO bucket name
- {name: Application name, type: String}  # Application name to include in the path
outputs:
- {name: MinIO path, type: String}  # Output MinIO path
implementation:
    container:
        image: nikhilv215/minio_update:1  # Using the custom image
        command:
        - sh
        - -ex
        - -c
        - |
            #!/bin/sh
            DATA_PATH="$1"
            BUCKET_NAME="$2"
            APP_NAME="$3"
            MINIO_PATH="$4"

            # Set up MinIO alias
            mc alias set myminio http://minio-service.kubeflow.svc.cluster.local:9000 minio minio123

            # Check if the bucket exists, if not create it
            if ! mc ls myminio/"$BUCKET_NAME"; then
              mc mb myminio/"$BUCKET_NAME"
            fi

            # Copy the contents to MinIO
            if [ -d "$DATA_PATH" ]; then
              mc cp --recursive "$DATA_PATH/" "myminio/$BUCKET_NAME/$APP_NAME/1/"
            else
              echo "The specified input path does not exist or is not a directory."
            fi

            # Save the MinIO path to the output
            echo "s3://$BUCKET_NAME/$APP_NAME/" > "$MINIO_PATH"
        args:
        - {inputPath: Data}
        - {inputValue: MinIO bucket name}
        - {inputValue: Application name}
        - {outputPath: MinIO path}
