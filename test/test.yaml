name: Trigger ML Pipeline 100 Times
description: Executes the same ML pipeline trigger API request 100 times.

inputs: []

outputs:
  - {name: responseLog, type: string}

implementation:
  container:
    image: python:3.8
    command:
      - sh
      - -c
      - |
        PIP_DISABLE_PIP_VERSION_CHECK=1 python3 -m pip install --quiet requests || \
        PIP_DISABLE_PIP_VERSION_CHECK=1 python3 -m pip install --quiet requests --user
        exec "$0" "$@"
      - python3
      - -u
      - -c
      - |
        import requests
        import argparse
        import os

        parser = argparse.ArgumentParser()
        parser.add_argument("--responseLog", required=True)
        args = parser.parse_args()

        url = "https://ig.gov-cloud.ai/bob-service-test/v1.0/pipeline/trigger/ml?pipelineId=019b021a-d758-71ea-9417-64ef0c0f404b"

        payload = {
            "pipelineType": "ML",
            "containerResources": {},
            "experimentId": "e5fc7d4b-1fa9-4a84-acf5-f8731007d29f",
            "enableCaching": True,
            "parameters": {},
            "version": 1
        }

        headers = {
            "accept": "application/json",
            "Authorization": "Bearer eyJhbGciOiJSUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICI3Ny1NUVdFRTNHZE5adGlsWU5IYmpsa2dVSkpaWUJWVmN1UmFZdHl5ejFjIn0.eyJleHAiOjE3NjU0MTQ1NTUsImlhdCI6MTc2NTM3ODU1NSwianRpIjoiNWFjNDFiODktMWNjNi00MGU0LWEyMmMtYTA2MzcwZWYwYzc4IiwiaXNzIjoiaHR0cDovL2tleWNsb2FrLXNlcnZpY2Uua2V5Y2xvYWsuc3ZjLmNsdXN0ZXIubG9jYWw6ODA4MC9yZWFsbXMvbWFzdGVyIiwiYXVkIjpbIkJPTFRaTUFOTl9CT1RfbW9iaXVzIiwiYWNjb3VudCJdLCJzdWIiOiJmNzFmMzU5My1hNjdhLTQwYmMtYTExYS05YTQ0NjY4YjQxMGQiLCJ0eXAiOiJCZWFyZXIiLCJhenAiOiJIT0xBQ1JBQ1lfbW9iaXVzIiwic2lkIjoiM2QxMzhhYTEtMmJhNi00YTc5LThmZTItNTYzNzgxNjEwMDYxIiwiYWNyIjoiMSIsImFsbG93ZWQtb3JpZ2lucyI6WyIvKiJdLCJyZWFsbV9hY2Nlc3MiOnsicm9sZXMiOlsiN2IwNzE1ZGQzYmFjNDkwYmIzZWQzaXBwMV8xZjA1MzVjOGQ2ZTM0MGQ1YmM2MzdpcHAxX1BST0RVQ1RfT1dORVIiLCI3YjA3MTVkZDNiYWM0OTBiYjNlZDNpcHAxX2IxNDYyZTZmYjYwYzQwYmQ4MWRlMWlwcDFfUFJPRFVDVF9PV05FUiIsIjdiMDcxNWRkM2JhYzQ5MGJiM2VkM2lwcDFfMzRiMWY5YTFhZjAyNDk2MWI5OTA1aXBwMV9QUk9EVUNUX09XTkVSIiwiN2IwNzE1ZGQzYmFjNDkwYmIzZWQzaXBwMV9hOWQzOGNlMDNhZDI0NDI1YTAwMWNpcHAxX1BST0RVQ1RfT1dORVIiLCI3YjA3MTVkZDNiYWM0OTBiYjNlZDNpcHAxXzIxNjk0MDJlNzBjNTQ0NzliZWNhNWlwcDFfUFJPRFVDVF9PV05FUiIsIjdiMDcxNWRkM2JhYzQ5MGJiM2VkM2lwcDFfZjg2MzllOTBmNzYwNDA1NWJkNjZlaXBwMV9QUk9EVUNUX09XTkVSIiwiYTBhZTYzNjRkYmJjNDljYTk5NDBjaXBwMV9kMzk3ODUzY2I4Y2I0ZGM0OWZlNzNpcHAxX1BST0RVQ1RfT1dORVIiLCI3YjA3MTVkZDNiYWM0OTBiYjNlZDNpcHAxX2U2ODMxNjMzNWU1YzQxOGJhOTY2OWlwcDFfUFJPRFVDVF9PV05FUiIsIjY3ZTE0NzE1MDZkYTc1MmI3ODcxNmQyMV83YjU5OWQzNDg4MmQ0ZjcyODg1ZTNpcHAxX1BST0RVQ1RfT1dORVIiLCI3YjA3MTVkZDNiYWM0OTBiYjNlZDNpcHAxXzQwM2E0MjUyMjJjYzQwZmU4ZTk2NmlwcDFfUFJPRFVDVF9PV05FUiIsIjczNWQ1YzM5OWQyNjQ0ZmZhODEzYmlwcDFfU1VQRVJBRE1JTiIsIjdiMDcxNWRkM2JhYzQ5MGJiM2VkM2lwcDFfYmNlZGM2Zjk5ZmJhNGIxMmIwZjQwaXBwMV9QUk9EVUNUX09XTkVSIiwidW1hX2F1dGhvcml6YXRpb24iLCI3YjA3MTVkZDNiYWM0OTBiYjNlZDNpcHAxXzdmNTQ1MzgxNmIwZjQyM2ZiNDc3OGlwcDFfUFJPRFVDVF9PV05FUiIsIjdiMDcxNWRkM2JhYzQ5MGJiM2VkM2lwcDFfN2NhOWZhZjFmMGJiNGMwN2I1NzYyaXBwMV9QUk9EVUNUX09XTkVSIiwiN2IwNzE1ZGQzYmFjNDkwYmIzZWQzaXBwMV9QTEFURk9STV9SRUFEX09OTFkiLCI2N2UxNDcxNTA2ZGE3NTJiNzg3MTZkMjFfOTJhZWQ1MDgwODcwNGQ3M2FiZWMwaXBwMV9QUk9EVUNUX09XTkVSIiwiN2IwNzE1ZGQzYmFjNDkwYmIzZWQzaXBwMV81ZWExMWE4YzZlNTI0YzlkODQ4YjBpcHAxX1BST0RVQ1RfT1dORVIiLCI2N2UxNDcxNTA2ZGE3NTJiNzg3MTZkMjFfNDYyYTRmMDQ2N2VmNDkwNzk4M2IzaXBwMV9QUk9EVUNUX09XTkVSIiwiN2IwNzE1ZGQzYmFjNDkwYmIzZWQzaXBwMV9TVVBFUkFETUlOIiwiN2IwNzE1ZGQzYmFjNDkwYmIzZWQzaXBwMV8wMmQ1ZGY0ZDVmNjQ0M2NkYWJmMjlpcHAxX1BST0RVQ1RfT1dORVIiLCI3YjA3MTVkZDNiYWM0OTBiYjNlZDNpcHAxXzhmNjIxYjFlYzZmMjQ4ZGE4NDg5MGlwcDFfUFJPRFVDVF9PV05FUiIsIjdiMDcxNWRkM2JhYzQ5MGJiM2VkM2lwcDFfYjU3M2M3ZmU5NTA5NDRhNDgwZTVmaXBwMV9QUk9EVUNUX09XTkVSIiwiNjdlMTQ3MTUwNmRhNzUyYjc4NzE2ZDIxX2I0MzE1MTQ2ODM1NjQ1YjJhYmFhZWlwcDFfUFJPRFVDVF9PV05FUiIsIjdiMDcxNWRkM2JhYzQ5MGJiM2VkM2lwcDFfNWUzNzZjZDgxYjM5NGMyNDhiMDgxaXBwMV9QUk9EVUNUX09XTkVSIiwiN2IwNzE1ZGQzYmFjNDkwYmIzZWQzaXBwMV9jNDBmYzQzYzA5NGU0Njc3YjYxYWZpcHAxX1BST0RVQ1RfT1dORVIiLCI3YjA3MTVkZDNiYWM0OTBiYjNlZDNpcHAxX2Y3NzQ5ZmU5YzQzOTQyMTFhODEyM2lwcDFfUFJPRFVDVF9PV05FUiIsIjdiMDcxNWRkM2JhYzQ5MGJiM2VkM2lwcDFfZDdhNTk2NmQ4MmU3NGY2MGFjMWU5aXBwMV9QUk9EVUNUX09XTkVSIiwiNjdlMTQ3MTUwNmRhNzUyYjc4NzE2ZDIxXzkxMzgxNTQwMzA2ZDQyZjk4OTg3Y2lwcDFfUFJPRFVDVF9PV05FUiIsIjdiMDcxNWRkM2JhYzQ5MGJiM2VkM2lwcDFfUExBVEZPUk1fQURNSU4iLCI2N2UxNDcxNTA2ZGE3NTJiNzg3MTZkMjFfYzM5MzI5OWEwZDQyNGU0YmExYWQ3aXBwMV9QUk9EVUNUX09XTkVSIiwiN2IwNzE1ZGQzYmFjNDkwYmIzZWQzaXBwMV85ZGQxYjM0YTdhOTM0YTM4OGM3OWZpcHAxX1BST0RVQ1RfT1dORVIiLCI2N2UxNDcxNTA2ZGE3NTJiNzg3MTZkMjFfMWE5NDlmZDg3MTcxNDMxNmFjYmNmaXBwMV9QUk9EVUNUX09XTkVSIiwiN2IwNzE1ZGQzYmFjNDkwYmIzZWQzaXBwMV8wMzIzNDVlM2RjZTM0MWUxYmE5YzRpcHAxX1BST0RVQ1RfT1dORVIiLCJhMGFlNjM2NGRiYmM0OWNhOTk0MGNpcHAxX1NVUEVSQURNSU4iLCI3YjA3MTVkZDNiYWM0OTBiYjNlZDNpcHAxXzgwMDBjZGYzNTg4NzQxYWRhNmM1YWlwcDFfUFJPRFVDVF9PV05FUiIsIjdiMDcxNWRkM2JhYzQ5MGJiM2VkM2lwcDFfNTEzZGQ2MGU4NTI2NGE4NmEyZDg5aXBwMV9QUk9EVUNUX09XTkVSIiwiN2IwNzE1ZGQzYmFjNDkwYmIzZWQzaXBwMV8xYjZhNWFmOGY3OTI0OGYzYjU3NDBpcHAxX1BST0RVQ1RfT1dORVIiLCI3YjA3MTVkZDNiYWM0OTBiYjNlZDNpcHAxXzJjNjhmOTcxNDFhYTQwMDA4M2M2ZWlwcDFfUFJPRFVDVF9PV05FUiIsIjdiMDcxNWRkM2JhYzQ5MGJiM2VkM2lwcDFfZGM2OGIwNTA2ZmYwNGM0MWIxZmJjaXBwMV9QUk9EVUNUX09XTkVSIiwiN2IwNzE1ZGQzYmFjNDkwYmIzZWQzaXBwMV9kNzk5NTI5ZWI1N2Q0ODVlOGNjYjFpcHAxX1BST0RVQ1RfT1dORVIiLCI3YjA3MTVkZDNiYWM0OTBiYjNlZDNpcHAxX2IxZTYyNjRjZTQxYzQ1YTY5ZGVhNWlwcDFfUFJPRFVDVF9PV05FUiIsIjdiMDcxNWRkM2JhYzQ5MGJiM2VkM2lwcDFfNjdhNGM5Nzk2NzQ5NGE3YjlkM2RiaXBwMV9QUk9EVUNUX09XTkVSIiwiN2IwNzE1ZGQzYmFjNDkwYmIzZWQzaXBwMV81ZWVlN2FlNjU2ZDA0MjZhODU1ZThpcHAxX1BST0RVQ1RfT1dORVIiLCJvZmZsaW5lX2FjY2VzcyIsIjdiMDcxNWRkM2JhYzQ5MGJiM2VkM2lwcDFfMmY3MzU5MGZiMzNkNDlkNzg5ZjE1aXBwMV9QUk9EVUNUX09XTkVSIiwiN2IwNzE1ZGQzYmFjNDkwYmIzZWQzaXBwMV9lODBhNTMxMzIxYzg0ZDhkOWYwYmZpcHAxX1BST0RVQ1RfT1dORVIiLCI3YjA3MTVkZDNiYWM0OTBiYjNlZDNpcHAxXzA3YTRjNTMwN2E5ZDQwZGZhOWMwOWlwcDFfUFJPRFVDVF9PV05FUiIsImRlZmF1bHQtcm9sZXMtbWFzdGVyIiwiN2IwNzE1ZGQzYmFjNDkwYmIzZWQzaXBwMV8xY2QzNDE4YjRjNzE0NDBhYTRlMzlpcHAxX1BST0RVQ1RfT1dORVIiLCJhMGFlNjM2NGRiYmM0OWNhOTk0MGNpcHAxX1BMQVRGT1JNX1JFQURfT05MWSIsIjdiMDcxNWRkM2JhYzQ5MGJiM2VkM2lwcDFfNzdhNzMwNWRiNWUzNDBmYjlmNWU5aXBwMV9QUk9EVUNUX09XTkVSIiwiN2IwNzE1ZGQzYmFjNDkwYmIzZWQzaXBwMV8wYjlkOWU0YzllZjY0ZGFlYTk4ODlpcHAxX1BST0RVQ1RfT1dORVIiLCI2N2UxNDcxNTA2ZGE3NTJiNzg3MTZkMjFfN2RmYzdiOTQ5MzZjNDc2MzkzNWMyaXBwMV9QUk9EVUNUX09XTkVSIiwiN2IwNzE1ZGQzYmFjNDkwYmIzZWQzaXBwMV81MjljNjg4MDFjYzg0YWI5YjQ0NTJpcHAxX1BST0RVQ1RfT1dORVIiLCJhMGFlNjM2NGRiYmM0OWNhOTk0MGNpcHAxX1BMQVRGT1JNX0FETUlOIiwiN2IwNzE1ZGQzYmFjNDkwYmIzZWQzaXBwMV85NWU4ZDRhODEwMDc0MDE3YTg0ZDZpcHAxX1BST0RVQ1RfT1dORVIiLCI3YjA3MTVkZDNiYWM0OTBiYjNlZDNpcHAxXzM1YTJiZWUyYjJhMTQ5NWY5NmM4Y2lwcDFfUFJPRFVDVF9PV05FUiIsIjdiMDcxNWRkM2JhYzQ5MGJiM2VkM2lwcDFfNWM1YmEyM2IxMzFkNDhkODhjMzU4aXBwMV9QUk9EVUNUX09XTkVSIiwiN2IwNzE1ZGQzYmFjNDkwYmIzZWQzaXBwMV9kZjY5MWFmMzk4MTU0N2JmOTVkYjVpcHAxX1BST0RVQ1RfT1dORVIiLCI2N2UxNDcxNTA2ZGE3NTJiNzg3MTZkMjFfZTNhNjNhNTE2ZTgyNGE5MGJjNTYwaXBwMV9QUk9EVUNUX09XTkVSIl19LCJyZXNvdXJjZV9hY2Nlc3MiOnsiSE9MQUNSQUNZX21vYml1cyI6eyJyb2xlcyI6WyJORUdPVEFUSU9OX0FQUFJPVkUiLCJQUk9EVUNUX0NSRUFUSU9OX1JFQUQiLCJBTExJQU5DRV9XUklURSIsIkFMTElBTkNFX0VYRUNVVEUiLCJURU5BTlRfV1JJVEUiLCJQTEFURk9STV9XUklURSIsIlJBVEVfQ0FSRF9XUklURSIsIkhPTEFDUkFDWV9VU0VSIiwiUkFURV9DQVJEX0FQUFJPVkUiLCJBTExJQU5DRV9BUFBST1ZFIiwiTkVHT1RBVElPTl9XUklURSIsIlRFTkFOVF9FWEVDVVRFIiwiUFJPRFVDVF9MSVNUSU5HX0FQUFJPVkUiLCJQUk9EVUNUX0xJU1RJTkdfRVhFQ1VURSIsIlNVQl9BTExJQU5DRV9XUklURSIsIlBST0RVQ1RfQ1JFQVRJT05fRVhFQ1VURSIsIk5FR09UQVRJT05fRVhFQ1VURSIsIlBST0RVQ1RfTElTVElOR19XUklURSIsIlBST0RVQ1RfQ1JFQVRJT05fQVBQUk9WRSIsIlNVUEVSQURNSU4iLCJQUk9EVUNUX0NSRUFUSU9OX1dSSVRFIiwiUFJPRFVDVF9MSVNUSU5HX1JFQUQiLCJBTExJQU5DRV9SRUFEIiwiUkFURV9DQVJEX0VYRUNVVEUiLCJTVUJfQUxMSUFOQ0VfUkVBRCIsIlRFTkFOVF9BUFBST1ZFIiwiQUdFTlRTX1JFQUQiLCJQTEFURk9STV9SRUFEIiwiVEVOQU5UX1JFQUQiLCJQTEFURk9STV9FWEVDVVRFIiwiU1VCX0FMTElBTkNFX0VYRUNVVEUiLCJTVUJfQUxMSUFOQ0VfQVBQUk9WRSIsIk5FR09UQVRJT05fUkVBRCIsIlJBVEVfQ0FSRF9SRUFEIiwiUExBVEZPUk1fQVBQUk9WRSJdfSwiQk9MVFpNQU5OX0JPVF9tb2JpdXMiOnsicm9sZXMiOlsiQk9MVFpNQU5OX0JPVF9VU0VSIl19LCJhY2NvdW50Ijp7InJvbGVzIjpbIm1hbmFnZS1hY2NvdW50IiwibWFuYWdlLWFjY291bnQtbGlua3MiLCJ2aWV3LXByb2ZpbGUiXX19LCJzY29wZSI6InByb2ZpbGUgZW1haWwiLCJyZXF1ZXN0ZXJUeXBlIjoiVEVOQU5UIiwiZW1haWxfdmVyaWZpZWQiOnRydWUsIm5hbWUiOiJrc2FteHAga3NhbXhwIiwidGVuYW50SWQiOiJmNzFmMzU5My1hNjdhLTQwYmMtYTExYS05YTQ0NjY4YjQxMGQiLCJwbGF0Zm9ybUlkIjoibW9iaXVzIiwicHJlZmVycmVkX3VzZXJuYW1lIjoicGFzc3dvcmRfdGVuYW50X2tzYW14cEBtb2JpdXNkdGFhcy5haSIsImdpdmVuX25hbWUiOiJrc2FteHAiLCJmYW1pbHlfbmFtZSI6ImtzYW14cCIsImVtYWlsIjoicGFzc3dvcmRfdGVuYW50X2tzYW14cEBtb2JpdXNkdGFhcy5haSJ9.hFmL4-HD_rN2Y_MpxzKr5F3b2PcszNgpE2UkLBxXnlcu_p4KCu9DTRtLZQa0rgmpHKgu_ZiCeyY7pvSehZnd5_9ciXx-9GTsb_W3VNcKSw-rMld7SuNvP_lHcoADycyVAJt-88MMFf-up5NCpr65nnW4BmtcQ5XVfShimBX0j7xA7xRAK5RuVX7QMyg8xuj60vvIjgZ2juP5NvxM6nS0rw6BFpkYNSPFJmLOvQTNdWsqStXaCpoTBH2EkiV8MWINUDmwXL7LZ9ZtzGsKB1-8eNIE6W_otcvavP5imgk2svq7ny4nUh4bJMMU1u1TO964XeSdx25uD1Oi38ww2HfwsQ",
            "Content-Type": "application/json"
        }

        logs = []
        for i in range(100):
            resp = requests.post(url, headers=headers, json=payload)
            print(resp.json())
            logs.append(f"Run {i+1}: {resp.status_code} | {resp.text}")

        def write_output(path, value):
            os.makedirs(os.path.dirname(path), exist_ok=True)
            with open(path, "w") as f:
                f.write(value)

        write_output(args.responseLog, '\\n\\n'.join(logs))

    args:
      - --responseLog
      - {outputPath: responseLog}
